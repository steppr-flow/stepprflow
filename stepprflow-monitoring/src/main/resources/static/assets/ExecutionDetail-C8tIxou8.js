import{i as T,b as o,c as n,F as S,d as e,p as E,t as a,g as c,r as A,e as h,x as I,s as j,m as F,v as O,y as N,h as $,k as C,z as U,j as H,l as z,w as B,T as G,A as K,u as W,o as q,a as X,f as Y,n as D}from"./index-joplyjTx.js";import{_ as L}from"./StatusBadge-Cuy5KiUG.js";import{_ as J,f as Q}from"./ConfirmModal-BvCGghS8.js";const Z={class:"font-mono text-sm"},ee={class:"text-gray-500"},te={key:0,class:"text-gray-400 text-xs ml-1"},se={key:0,class:"ml-4 border-l border-gray-200 pl-3 space-y-0.5"},oe={class:"text-purple-600 shrink-0"},ae={key:1,class:"text-gray-500"},ne={key:1,class:"inline-flex items-center gap-1"},le={__name:"PayloadNode",props:{value:{type:[Object,Array,String,Number,Boolean,null],default:null},path:{type:String,default:""},editMode:{type:Boolean,default:!1}},emits:["update"],setup(x,{emit:_}){const i=x,s=_,y=C(!0),p=C(!1),v=C(""),r=C(null),u=$(()=>i.value!==null&&typeof i.value=="object"),d=$(()=>Array.isArray(i.value)),k=$(()=>i.value===null||i.value===void 0?"text-gray-400 italic":typeof i.value=="string"?"text-emerald-600":typeof i.value=="number"?"text-amber-600":typeof i.value=="boolean"?"text-sky-600":"text-gray-700"),P=$(()=>i.value===null||i.value===void 0?"null":typeof i.value=="string"?`"${i.value}"`:String(i.value));function R(g){return i.path?`${i.path}.${g}`:String(g)}function V(){v.value=i.value===null?"":String(i.value),p.value=!0,U(()=>r.value?.focus())}function M(){let g=v.value;if(typeof i.value=="number"){const m=Number(g);isNaN(m)||(g=m)}else typeof i.value=="boolean"&&(g=g==="true");s("update",i.path,g),p.value=!1}return(g,m)=>{const f=T("PayloadNode",!0);return o(),n("div",Z,[u.value?(o(),n(S,{key:0},[e("div",{class:"flex items-center gap-1 cursor-pointer select-none hover:bg-gray-100 rounded px-1 -mx-1",onClick:m[0]||(m[0]=t=>y.value=!y.value)},[(o(),n("svg",{class:E(["h-3.5 w-3.5 text-gray-400 transition-transform",{"rotate-90":y.value}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...m[5]||(m[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"},null,-1)])],2)),e("span",ee,a(d.value?"[":"{"),1),y.value?c("",!0):(o(),n("span",te,a(d.value?`${Object.keys(x.value).length} items`:`${Object.keys(x.value).length} keys`)+" "+a(d.value?"]":"}"),1))]),y.value?(o(),n("div",se,[(o(!0),n(S,null,A(x.value,(t,b)=>(o(),n("div",{key:b,class:"flex items-start gap-1"},[e("span",oe,a(d.value?`[${b}]`:b)+":",1),h(f,{value:t,path:R(b),"edit-mode":x.editMode,onUpdate:m[1]||(m[1]=(l,w)=>g.$emit("update",l,w))},null,8,["value","path","edit-mode"])]))),128))])):c("",!0),y.value?(o(),n("div",ae,a(d.value?"]":"}"),1)):c("",!0)],64)):(o(),n(S,{key:1},[p.value?(o(),n("span",ne,[F(e("input",{ref_key:"editInput",ref:r,"onUpdate:modelValue":m[2]||(m[2]=t=>v.value=t),class:"input-sm max-w-[200px]",onKeydown:[N(M,["enter"]),m[3]||(m[3]=N(t=>p.value=!1,["escape"]))]},null,544),[[O,v.value]]),e("button",{class:"btn-primary btn-sm !px-1.5 !py-0.5 text-xs",onClick:M},"OK"),e("button",{class:"btn-secondary btn-sm !px-1.5 !py-0.5 text-xs",onClick:m[4]||(m[4]=t=>p.value=!1)},"X")])):(o(),n("span",{key:0,class:E([k.value,"group inline-flex items-center gap-1"])},[I(a(P.value)+" ",1),x.editMode?(o(),n("button",{key:0,class:"hidden group-hover:inline-flex h-4 w-4 items-center justify-center rounded text-gray-400 hover:text-primary-600 hover:bg-primary-50",onClick:j(V,["stop"])},[...m[6]||(m[6]=[e("svg",{class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487z"})],-1)])])):c("",!0)],2))],64))])}}},re={class:"space-y-3"},ie={class:"flex items-center justify-between"},de={class:"flex items-center gap-2"},ue={class:"rounded-lg border border-gray-200 bg-gray-50 p-4 overflow-auto max-h-[600px]"},ce={key:1,class:"text-sm text-gray-400 italic"},me={__name:"PayloadEditor",props:{payload:{type:[Object,Array,String,Number,Boolean],default:null},hasChanges:{type:Boolean,default:!1}},emits:["update","restore"],setup(x,{emit:_}){const i=_,s=C(!1);function y(p,v){i("update",p,v)}return(p,v)=>(o(),n("div",re,[e("div",ie,[v[2]||(v[2]=e("h3",{class:"text-sm font-medium text-gray-700"},"Payload",-1)),e("div",de,[x.hasChanges?(o(),n("button",{key:0,class:"btn-secondary btn-sm",onClick:v[0]||(v[0]=r=>p.$emit("restore"))}," Restore original ")):c("",!0),e("button",{class:E(["btn-secondary btn-sm",{"!bg-primary-50 !text-primary-700 !border-primary-300":s.value}]),onClick:v[1]||(v[1]=r=>s.value=!s.value)},a(s.value?"Done editing":"Edit"),3)])]),e("div",ue,[x.payload!==null&&x.payload!==void 0?(o(),H(le,{key:0,value:x.payload,path:"","edit-mode":s.value,onUpdate:y},null,8,["value","edit-mode"])):(o(),n("p",ce,"No payload"))])]))}},xe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ye={class:"relative z-10 w-full max-w-lg rounded-xl bg-white p-6 shadow-2xl"},fe={class:"mt-4 rounded-lg bg-gray-50 border border-gray-200 p-3 text-sm"},ve={class:"flex items-center gap-2 text-gray-600"},pe={class:"rounded bg-gray-200 px-1.5 py-0.5 text-xs font-mono"},ge={class:"mt-1.5 grid grid-cols-2 gap-2 text-xs"},be={class:"ml-1 font-mono text-red-600"},he={class:"ml-1 font-mono text-emerald-600"},_e=["onKeydown"],ke={class:"mt-4 flex gap-3"},we=["disabled"],$e={__name:"ChangeReasonModal",props:{show:{type:Boolean,default:!1},fieldPath:{type:String,default:""},oldValue:{default:null},newValue:{default:null}},emits:["confirm","cancel"],setup(x,{emit:_}){const i=x,s=_,y=C(""),p=C(null);z(()=>i.show,u=>{u&&(y.value="",U(()=>p.value?.focus()))});function v(u){return u==null?"null":typeof u=="string"?`"${u}"`:String(u)}function r(){y.value.trim()&&s("confirm",y.value.trim())}return(u,d)=>(o(),H(K,{to:"body"},[h(G,{name:"modal"},{default:B(()=>[x.show?(o(),n("div",xe,[e("div",{class:"fixed inset-0 bg-black/40",onClick:d[0]||(d[0]=k=>u.$emit("cancel"))}),e("div",ye,[d[6]||(d[6]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Change Reason",-1)),d[7]||(d[7]=e("p",{class:"mt-1 text-sm text-gray-500"},"Provide a reason for this payload change.",-1)),e("div",fe,[e("div",ve,[d[3]||(d[3]=e("span",{class:"font-medium"},"Field:",-1)),e("code",pe,a(x.fieldPath),1)]),e("div",ge,[e("div",null,[d[4]||(d[4]=e("span",{class:"text-gray-400"},"From:",-1)),e("span",be,a(v(x.oldValue)),1)]),e("div",null,[d[5]||(d[5]=e("span",{class:"text-gray-400"},"To:",-1)),e("span",he,a(v(x.newValue)),1)])])]),F(e("textarea",{ref_key:"reasonInput",ref:p,"onUpdate:modelValue":d[1]||(d[1]=k=>y.value=k),class:"input mt-4 min-h-[80px] resize-y",placeholder:"Why are you making this change?",onKeydown:[N(j(r,["meta"]),["enter"]),N(j(r,["ctrl"]),["enter"])]},null,40,_e),[[O,y.value]]),e("div",ke,[e("button",{class:"btn-secondary flex-1",onClick:d[2]||(d[2]=k=>u.$emit("cancel"))},"Cancel"),e("button",{class:"btn-primary flex-1",disabled:!y.value.trim(),onClick:r}," Apply Change ",8,we)])])])):c("",!0)]),_:1})]))}},Ce={key:0,class:"flex items-center justify-center py-20"},Ie={key:1,class:"flex items-center justify-center py-20"},Se={class:"text-center"},Ee={key:2,class:"space-y-6"},Pe={class:"flex items-start justify-between"},Me={class:"mt-1 text-2xl font-bold text-gray-900"},Ae={class:"mt-0.5 font-mono text-sm text-gray-500"},Ne={class:"flex items-center gap-2"},Re={class:"grid gap-6 lg:grid-cols-3"},Ve={class:"card flex flex-col items-center justify-center"},je={class:"h-32 w-32",viewBox:"0 0 120 120"},Be=["stroke-dashoffset"],De={x:"60",y:"55","text-anchor":"middle",class:"fill-gray-900 text-2xl font-bold","font-size":"24"},Le={x:"60",y:"75","text-anchor":"middle",class:"fill-gray-400 text-xs","font-size":"12"},Te={class:"card lg:col-span-2"},Fe={class:"grid grid-cols-2 gap-x-6 gap-y-3 text-sm"},Oe={class:"font-mono text-gray-900"},Ue={class:"text-gray-900"},He={class:"text-gray-900"},ze={class:"text-gray-900"},Ge={class:"text-gray-900"},Ke={class:"text-gray-900"},We={key:0,class:"card"},qe={class:"grid grid-cols-3 gap-4 text-sm"},Xe={class:"font-medium text-gray-900"},Ye={class:"text-gray-900"},Je={class:"text-gray-900"},Qe={key:1,class:"card border-red-200 bg-red-50"},Ze={class:"text-sm text-red-800"},et={key:0,class:"mt-3 max-h-40 overflow-auto rounded bg-red-100 p-3 text-xs text-red-900"},tt={class:"card"},st={key:2,class:"card"},ot={class:"space-y-3"},at={class:"flex items-center justify-between"},nt={class:"text-sm font-medium text-gray-900"},lt={class:"text-xs text-gray-500"},rt={class:"mt-1 text-xs text-gray-500"},it={key:0,class:"mt-1 text-xs text-red-600"},dt={key:3,class:"card"},ut={class:"relative space-y-0"},ct={class:"flex flex-col items-center"},mt={class:"text-xs font-bold"},xt={key:0,class:"w-px flex-1 bg-gray-200"},yt={class:"flex-1 pb-2"},ft={class:"flex items-center justify-between"},vt={class:"text-sm font-medium text-gray-900"},pt={class:"mt-0.5 text-xs text-gray-500"},gt={key:0},bt={key:1,class:"ml-2"},ht={key:0,class:"mt-1 text-xs text-red-600"},_t={key:4,class:"card"},kt={class:"space-y-2"},wt={class:"flex items-center justify-between"},$t={class:"rounded bg-gray-100 px-1.5 py-0.5 text-xs"},Ct={class:"text-xs text-gray-400"},It={class:"mt-1 grid grid-cols-2 gap-2 text-xs"},St={class:"font-mono text-red-600"},Et={class:"font-mono text-emerald-600"},Pt={key:0,class:"mt-1 text-xs text-gray-500 italic"},Rt={__name:"ExecutionDetail",props:{id:{type:String,required:!0}},setup(x){const _=x,i=W(),s=$(()=>i.currentExecution),y=2*Math.PI*52,p=$(()=>s.value?.totalSteps?Math.round(s.value.currentStep/s.value.totalSteps*100):0),v=$(()=>s.value?.payloadHistory?.length>0),r=D({show:!1,title:"",message:"",type:"warning",confirmLabel:"Confirm",onConfirm:()=>{}}),u=D({show:!1,fieldPath:"",oldValue:null,newValue:null});function d(f){return f?Q(new Date(f),"MMM d, HH:mm:ss"):"-"}function k(f){return f.status==="COMPLETED"||f.status==="PASSED"?"border-emerald-500 bg-emerald-50 text-emerald-700":f.status==="FAILED"?"border-red-500 bg-red-50 text-red-700":f.status==="IN_PROGRESS"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-500"}function P(f){f==="resume"?(r.title="Resume Execution",r.message="Resume this execution?",r.type="info",r.confirmLabel="Resume",r.onConfirm=async()=>{r.show=!1,await i.resumeExecution(s.value.executionId)}):(r.title="Cancel Execution",r.message="Cancel this execution? This cannot be undone.",r.type="danger",r.confirmLabel="Cancel Execution",r.onConfirm=async()=>{r.show=!1,await i.cancelExecution(s.value.executionId)}),r.show=!0}function R(){r.title="Restore Payload",r.message="Restore the payload to its original state? All changes will be reverted.",r.type="warning",r.confirmLabel="Restore",r.onConfirm=async()=>{r.show=!1,await i.restorePayload(s.value.executionId)},r.show=!0}function V(f,t){const b=g(s.value.payload,f);u.fieldPath=f,u.oldValue=b,u.newValue=t,u.show=!0}async function M(f){u.show=!1,await i.updatePayloadField(s.value.executionId,u.fieldPath,u.newValue,f)}function g(f,t){return t.split(".").reduce((b,l)=>b?.[l],f)}let m;return q(()=>{i.fetchExecution(_.id),m=setInterval(()=>{s.value&&(s.value.status==="IN_PROGRESS"||s.value.status==="PENDING")&&i.fetchExecution(_.id)},3e3)}),X(()=>{clearInterval(m),i.currentExecution=null}),(f,t)=>{const b=T("router-link");return Y(i).loading?(o(),n("div",Ce,[...t[4]||(t[4]=[e("div",{class:"text-sm text-gray-400"},"Loading execution...",-1)])])):s.value?(o(),n("div",Ee,[e("div",Pe,[e("div",null,[h(b,{to:"/executions",class:"text-sm text-gray-500 hover:text-gray-700"},{default:B(()=>[...t[7]||(t[7]=[I("← Back",-1)])]),_:1}),e("h1",Me,a(s.value.topic),1),e("p",Ae,a(s.value.executionId),1)]),e("div",Ne,[h(L,{status:s.value.status},null,8,["status"]),s.value.status==="FAILED"||s.value.status==="RETRY_PENDING"?(o(),n("button",{key:0,class:"btn-success btn-sm",onClick:t[0]||(t[0]=l=>P("resume"))}," Resume ")):c("",!0),s.value.status==="IN_PROGRESS"||s.value.status==="PENDING"?(o(),n("button",{key:1,class:"btn-danger btn-sm",onClick:t[1]||(t[1]=l=>P("cancel"))}," Cancel ")):c("",!0)])]),e("div",Re,[e("div",Ve,[(o(),n("svg",je,[t[8]||(t[8]=e("circle",{cx:"60",cy:"60",r:"52","stroke-width":"8",fill:"none",class:"stroke-gray-100"},null,-1)),e("circle",{cx:"60",cy:"60",r:"52","stroke-width":"8",fill:"none",class:"stroke-primary-500 transition-all duration-500","stroke-linecap":"round","stroke-dasharray":y,"stroke-dashoffset":y-y*p.value/100,transform:"rotate(-90 60 60)"},null,8,Be),e("text",De,a(s.value.currentStep??0),1),e("text",Le," of "+a(s.value.totalSteps??0),1)])),t[9]||(t[9]=e("p",{class:"mt-2 text-sm text-gray-500"},"Step Progress",-1))]),e("div",Te,[t[16]||(t[16]=e("h2",{class:"mb-4 text-sm font-semibold text-gray-900"},"Details",-1)),e("dl",Fe,[e("div",null,[t[10]||(t[10]=e("dt",{class:"text-gray-500"},"Correlation ID",-1)),e("dd",Oe,a(s.value.correlationId||"-"),1)]),e("div",null,[t[11]||(t[11]=e("dt",{class:"text-gray-500"},"Current Step",-1)),e("dd",Ue,a(s.value.currentStep??"-"),1)]),e("div",null,[t[12]||(t[12]=e("dt",{class:"text-gray-500"},"Created",-1)),e("dd",He,a(d(s.value.createdAt)),1)]),e("div",null,[t[13]||(t[13]=e("dt",{class:"text-gray-500"},"Updated",-1)),e("dd",ze,a(d(s.value.updatedAt)),1)]),e("div",null,[t[14]||(t[14]=e("dt",{class:"text-gray-500"},"Duration",-1)),e("dd",Ge,a(s.value.durationMs?(s.value.durationMs/1e3).toFixed(1)+"s":"-"),1)]),e("div",null,[t[15]||(t[15]=e("dt",{class:"text-gray-500"},"Initiated By",-1)),e("dd",Ke,a(s.value.initiatedBy||"-"),1)])])])]),s.value.retryInfo?(o(),n("div",We,[t[20]||(t[20]=e("h2",{class:"mb-3 text-sm font-semibold text-amber-700"},"Retry Information",-1)),e("dl",qe,[e("div",null,[t[17]||(t[17]=e("dt",{class:"text-gray-500"},"Attempt",-1)),e("dd",Xe,a(s.value.retryInfo.currentAttempt??"-"),1)]),e("div",null,[t[18]||(t[18]=e("dt",{class:"text-gray-500"},"Max Retries",-1)),e("dd",Ye,a(s.value.retryInfo.maxRetries??"-"),1)]),e("div",null,[t[19]||(t[19]=e("dt",{class:"text-gray-500"},"Next Retry",-1)),e("dd",Je,a(s.value.retryInfo.nextRetryAt?d(s.value.retryInfo.nextRetryAt):"-"),1)])])])):c("",!0),s.value.errorInfo?(o(),n("div",Qe,[t[21]||(t[21]=e("h2",{class:"mb-3 text-sm font-semibold text-red-700"},"Error",-1)),e("p",Ze,a(s.value.errorInfo.message||s.value.errorInfo),1),s.value.errorInfo.stackTrace?(o(),n("pre",et,a(s.value.errorInfo.stackTrace),1)):c("",!0)])):c("",!0),e("div",tt,[h(me,{payload:s.value.payload,"has-changes":v.value,onUpdate:V,onRestore:R},null,8,["payload","has-changes"])]),s.value.executionAttempts?.length?(o(),n("div",st,[t[22]||(t[22]=e("h2",{class:"mb-4 text-sm font-semibold text-gray-900"},"Execution Attempts",-1)),e("div",ot,[(o(!0),n(S,null,A(s.value.executionAttempts,l=>(o(),n("div",{key:l.attemptNumber,class:"rounded-lg border border-gray-100 p-3"},[e("div",at,[e("span",nt,"Attempt #"+a(l.attemptNumber),1),e("span",lt,a(d(l.startedAt)),1)]),e("div",rt,[I(" Steps "+a(l.startStep??"?")+" → "+a(l.endStep??"?")+" ",1),l.result?(o(),n("span",{key:0,class:E(["ml-2 font-medium",l.result==="SUCCESS"?"text-emerald-600":"text-red-600"])},a(l.result),3)):c("",!0)]),l.errorMessage?(o(),n("p",it,a(l.errorMessage),1)):c("",!0)]))),128))])])):c("",!0),s.value.stepHistory?.length?(o(),n("div",dt,[t[23]||(t[23]=e("h2",{class:"mb-4 text-sm font-semibold text-gray-900"},"Step History",-1)),e("div",ut,[(o(!0),n(S,null,A(s.value.stepHistory,(l,w)=>(o(),n("div",{key:w,class:"relative flex gap-4 pb-4"},[e("div",ct,[e("div",{class:E(["flex h-6 w-6 items-center justify-center rounded-full border-2",k(l)])},[e("span",mt,a(l.stepId??w+1),1)],2),w<s.value.stepHistory.length-1?(o(),n("div",xt)):c("",!0)]),e("div",yt,[e("div",ft,[e("span",vt,a(l.stepLabel||`Step ${l.stepId}`),1),h(L,{status:l.status,dot:!1},null,8,["status"])]),e("div",pt,[l.startedAt?(o(),n("span",gt,a(d(l.startedAt)),1)):c("",!0),l.durationMs?(o(),n("span",bt,a(l.durationMs)+"ms",1)):c("",!0)]),l.errorMessage?(o(),n("p",ht,a(l.errorMessage),1)):c("",!0)])]))),128))])])):c("",!0),s.value.payloadHistory?.length?(o(),n("div",_t,[t[28]||(t[28]=e("h2",{class:"mb-4 text-sm font-semibold text-gray-900"},"Payload Changes",-1)),e("div",kt,[(o(!0),n(S,null,A(s.value.payloadHistory,(l,w)=>(o(),n("div",{key:w,class:"rounded-lg border border-gray-100 p-3 text-sm"},[e("div",wt,[e("code",$t,a(l.fieldPath),1),e("span",Ct,a(d(l.changedAt)),1)]),e("div",It,[e("div",null,[t[24]||(t[24]=e("span",{class:"text-gray-400"},"From:",-1)),t[25]||(t[25]=I()),e("span",St,a(l.oldValue),1)]),e("div",null,[t[26]||(t[26]=e("span",{class:"text-gray-400"},"To:",-1)),t[27]||(t[27]=I()),e("span",Et,a(l.newValue),1)])]),l.reason?(o(),n("p",Pt,a(l.reason),1)):c("",!0)]))),128))])])):c("",!0),h(J,{show:r.show,title:r.title,message:r.message,type:r.type,"confirm-label":r.confirmLabel,onConfirm:r.onConfirm,onCancel:t[2]||(t[2]=l=>r.show=!1)},null,8,["show","title","message","type","confirm-label","onConfirm"]),h($e,{show:u.show,"field-path":u.fieldPath,"old-value":u.oldValue,"new-value":u.newValue,onConfirm:M,onCancel:t[3]||(t[3]=l=>u.show=!1)},null,8,["show","field-path","old-value","new-value"])])):(o(),n("div",Ie,[e("div",Se,[t[6]||(t[6]=e("p",{class:"text-lg font-medium text-gray-900"},"Execution not found",-1)),h(b,{to:"/executions",class:"mt-2 text-sm text-primary-600 hover:underline"},{default:B(()=>[...t[5]||(t[5]=[I("Back to executions",-1)])]),_:1})])]))}}};export{Rt as default};
