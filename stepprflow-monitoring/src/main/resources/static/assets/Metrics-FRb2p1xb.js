import{C as M,k as p,D as B,E as S,G as N,H as j,b as r,c as o,d as t,F as C,p as b,t as a,r as D,x as P,g,h as f,q as $,o as L,a as U,f as _,e as k}from"./index-joplyjTx.js";import{_ as w}from"./StatsCard-DJ-2egOf.js";const O=M("metrics",()=>{const n=p(null),e=p([]),i=p(null),u=p(null),m=p(null),x=p(!1),d=p(null);function y(){d.value=null}async function v(){x.value=!0,d.value=null;try{n.value=await B.getDashboard()}catch(h){d.value=h.message}finally{x.value=!1}}async function s(){try{e.value=await S.list()}catch(h){d.value=h.message}}async function c(){try{i.value=await S.getConfig()}catch(h){d.value=h.message}}async function l(h){try{return await S.reset(h),await s(),!0}catch(E){return d.value=E.message,!1}}async function R(){try{u.value=await N.get()}catch(h){h.status===503?u.value=h.details:d.value=h.message}}async function A(){try{m.value=await j.stats()}catch(h){d.value=h.message}}async function F(){await Promise.all([v(),s(),R(),A()])}return{dashboard:n,circuitBreakers:e,cbConfig:i,health:u,outbox:m,loading:x,error:d,clearError:y,fetchDashboard:v,fetchCircuitBreakers:s,fetchCbConfig:c,resetCircuitBreaker:l,fetchHealth:R,fetchOutbox:A,fetchAll:F}}),z={class:"card space-y-4"},G={key:0,class:"text-sm text-gray-400"},H={class:"flex items-center gap-2"},V={key:0,class:"space-y-3"},I={class:"flex items-center justify-between"},T={class:"text-sm font-medium text-gray-700"},W={key:0,class:"mt-2 space-y-1"},q={class:"font-mono text-gray-700"},J={__name:"HealthPanel",props:{health:{type:Object,default:null}},setup(n){const e=n,i=f(()=>e.health?e.health.status==="UP"?"text-emerald-700":e.health.status==="DEGRADED"?"text-amber-700":"text-red-700":"");return(u,m)=>(r(),o("div",z,[m[0]||(m[0]=t("h3",{class:"text-sm font-semibold text-gray-900"},"Health Status",-1)),n.health?(r(),o(C,{key:1},[t("div",H,[t("span",{class:b(["inline-flex h-3 w-3 rounded-full",n.health.status==="UP"?"bg-emerald-500":n.health.status==="DEGRADED"?"bg-amber-500":"bg-red-500"])},null,2),t("span",{class:b(["text-sm font-medium",i.value])},a(n.health.status),3)]),n.health.components?(r(),o("div",V,[(r(!0),o(C,null,D(n.health.components,(x,d)=>(r(),o("div",{key:d,class:"rounded-lg border border-gray-100 bg-gray-50 p-3"},[t("div",I,[t("span",T,a(d),1),t("span",{class:b(["inline-flex items-center gap-1 text-xs font-medium",x.status==="UP"?"text-emerald-600":"text-red-600"])},[t("span",{class:b(["h-1.5 w-1.5 rounded-full",x.status==="UP"?"bg-emerald-500":"bg-red-500"])},null,2),P(" "+a(x.status),1)],2)]),x.details?(r(),o("div",W,[(r(!0),o(C,null,D(x.details,(y,v)=>(r(),o("div",{key:v,class:"flex items-center justify-between text-xs text-gray-500"},[t("span",null,a(v),1),t("span",q,a(y),1)]))),128))])):g("",!0)]))),128))])):g("",!0)],64)):(r(),o("div",G,"Loading..."))]))}},K={class:"card space-y-4"},Q={class:"flex items-center justify-between"},X={key:0,class:"text-sm text-gray-400"},Y={class:"grid grid-cols-3 gap-3"},Z={class:"text-center"},tt={class:"text-lg font-semibold text-amber-600"},et={class:"text-center"},st={class:"text-lg font-semibold text-emerald-600"},at={class:"text-center"},lt={class:"text-lg font-semibold text-red-600"},rt={key:0,class:"space-y-1"},ot={class:"flex h-2 overflow-hidden rounded-full bg-gray-100"},nt={class:"flex justify-between text-xs text-gray-400"},it={__name:"OutboxPanel",props:{outbox:{type:Object,default:null}},setup(n){const e=n,i=f(()=>e.outbox?.total?e.outbox.sent/e.outbox.total*100:0),u=f(()=>e.outbox?.total?e.outbox.pending/e.outbox.total*100:0),m=f(()=>e.outbox?.total?e.outbox.failed/e.outbox.total*100:0),x=f(()=>e.outbox?.sendRate!=null?e.outbox.sendRate.toFixed(1):"0.0"),d=f(()=>e.outbox?e.outbox.health==="UP"?"bg-emerald-100 text-emerald-700":e.outbox.health==="WARNING"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700":""),y=f(()=>e.outbox?e.outbox.health==="UP"?"bg-emerald-500":e.outbox.health==="WARNING"?"bg-amber-500":"bg-red-500":"");return(v,s)=>(r(),o("div",K,[t("div",Q,[s[0]||(s[0]=t("h3",{class:"text-sm font-semibold text-gray-900"},"Outbox",-1)),n.outbox?(r(),o("span",{key:0,class:b(["inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium",d.value])},[t("span",{class:b(["h-1.5 w-1.5 rounded-full",y.value])},null,2),P(" "+a(n.outbox.health),1)],2)):g("",!0)]),n.outbox?(r(),o(C,{key:1},[t("div",Y,[t("div",Z,[t("p",tt,a(n.outbox.pending),1),s[1]||(s[1]=t("p",{class:"text-xs text-gray-500"},"Pending",-1))]),t("div",et,[t("p",st,a(n.outbox.sent),1),s[2]||(s[2]=t("p",{class:"text-xs text-gray-500"},"Sent",-1))]),t("div",at,[t("p",lt,a(n.outbox.failed),1),s[3]||(s[3]=t("p",{class:"text-xs text-gray-500"},"Failed",-1))])]),n.outbox.total>0?(r(),o("div",rt,[t("div",ot,[t("div",{class:"bg-emerald-500 transition-all",style:$({width:i.value+"%"})},null,4),t("div",{class:"bg-amber-500 transition-all",style:$({width:u.value+"%"})},null,4),t("div",{class:"bg-red-500 transition-all",style:$({width:m.value+"%"})},null,4)]),t("div",nt,[t("span",null,a(x.value)+"% delivered",1),t("span",null,a(n.outbox.total)+" total",1)])])):g("",!0)],64)):(r(),o("div",X,"Loading..."))]))}},dt={class:"space-y-6"},ct={class:"text-sm font-medium"},ut={key:1,class:"grid grid-cols-2 gap-4 lg:grid-cols-4"},xt={key:2,class:"grid gap-4 lg:grid-cols-2"},ht={class:"card-compact"},gt={class:"flex items-center justify-between mb-2"},ft={class:"text-sm font-semibold text-emerald-600"},bt={class:"h-2.5 rounded-full bg-gray-100 overflow-hidden"},mt={class:"card-compact"},vt={class:"flex items-center justify-between mb-2"},yt={class:"text-sm font-semibold text-red-600"},pt={class:"h-2.5 rounded-full bg-gray-100 overflow-hidden"},_t={class:"grid gap-6 lg:grid-cols-2"},kt={key:3,class:"card"},Ct={class:"space-y-3"},$t={class:"text-sm font-medium text-gray-900"},wt={class:"mt-1 flex gap-3 text-xs text-gray-500"},Dt={class:"flex items-center gap-2"},Rt=["onClick"],St={key:4,class:"card overflow-hidden !p-0"},At={class:"w-full text-sm"},Pt={class:"divide-y divide-gray-50"},Ft={class:"px-4 py-3 font-medium text-gray-900"},Et={class:"px-4 py-3 text-gray-500"},Mt={class:"px-4 py-3 text-right text-gray-700"},Bt={class:"px-4 py-3 text-right text-emerald-600"},Nt={class:"px-4 py-3 text-right text-red-600"},jt={class:"px-4 py-3 text-right text-blue-600"},Lt={class:"px-4 py-3 text-right text-gray-500"},Ut={class:"px-4 py-3 text-right"},Gt={__name:"Metrics",setup(n){const e=O(),i=f(()=>e.dashboard);function u(s){return s==null?"0.0":Number(s).toFixed(1)}function m(s){return s==="CLOSED"?"bg-emerald-100 text-emerald-700":s==="HALF_OPEN"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}async function x(s){await e.resetCircuitBreaker(s)}const d=f(()=>{const s=e.health?.status;return s==="UP"?"border-emerald-200 bg-emerald-50":s==="DEGRADED"?"border-amber-200 bg-amber-50":"border-red-200 bg-red-50"}),y=f(()=>{const s=e.health?.status;return s==="UP"?"bg-emerald-500":s==="DEGRADED"?"bg-amber-500":"bg-red-500"});let v;return L(()=>{e.fetchAll(),v=setInterval(()=>e.fetchAll(),1e4)}),U(()=>{clearInterval(v)}),(s,c)=>(r(),o("div",dt,[c[5]||(c[5]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Metrics",-1)),_(e).health?(r(),o("div",{key:0,class:b(["flex items-center gap-3 rounded-lg border p-4",d.value])},[t("span",{class:b(["h-3 w-3 rounded-full",y.value])},null,2),t("span",ct,"System health: "+a(_(e).health.status),1)],2)):g("",!0),i.value?(r(),o("div",ut,[k(w,{label:"Started",value:i.value.totalStarted??0,icon:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z",variant:"primary"},null,8,["value"]),k(w,{label:"Completed",value:i.value.totalCompleted??0,icon:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z",variant:"success"},null,8,["value"]),k(w,{label:"Failed",value:i.value.totalFailed??0,icon:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z",variant:"danger"},null,8,["value"]),k(w,{label:"Active",value:i.value.totalActive??0,icon:"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z",variant:"info"},null,8,["value"])])):g("",!0),i.value?(r(),o("div",xt,[t("div",ht,[t("div",gt,[c[0]||(c[0]=t("span",{class:"text-sm text-gray-600"},"Success Rate",-1)),t("span",ft,a(u(i.value.globalSuccessRate))+"%",1)]),t("div",bt,[t("div",{class:"h-full rounded-full bg-emerald-500 transition-all",style:$({width:u(i.value.globalSuccessRate)+"%"})},null,4)])]),t("div",mt,[t("div",vt,[c[1]||(c[1]=t("span",{class:"text-sm text-gray-600"},"Failure Rate",-1)),t("span",yt,a(u(i.value.globalFailureRate))+"%",1)]),t("div",pt,[t("div",{class:"h-full rounded-full bg-red-500 transition-all",style:$({width:u(i.value.globalFailureRate)+"%"})},null,4)])])])):g("",!0),t("div",_t,[k(J,{health:_(e).health},null,8,["health"]),k(it,{outbox:_(e).outbox},null,8,["outbox"])]),_(e).circuitBreakers.length?(r(),o("div",kt,[c[2]||(c[2]=t("h2",{class:"mb-4 text-sm font-semibold text-gray-900"},"Circuit Breakers",-1)),t("div",Ct,[(r(!0),o(C,null,D(_(e).circuitBreakers,l=>(r(),o("div",{key:l.name,class:"flex items-center justify-between rounded-lg border border-gray-100 p-3"},[t("div",null,[t("p",$t,a(l.name),1),t("div",wt,[t("span",null,"Success: "+a(l.successfulCalls),1),t("span",null,"Failed: "+a(l.failedCalls),1),t("span",null,"Failure rate: "+a(u(l.failureRate))+"%",1)])]),t("div",Dt,[t("span",{class:b(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",m(l.state)])},a(l.state),3),l.state!=="CLOSED"?(r(),o("button",{key:0,class:"btn-secondary btn-sm",onClick:R=>x(l.name)}," Reset ",8,Rt)):g("",!0)])]))),128))])])):g("",!0),i.value?.workflowMetrics?.length?(r(),o("div",St,[c[4]||(c[4]=t("div",{class:"border-b border-gray-100 bg-gray-50 px-4 py-3"},[t("h2",{class:"text-sm font-semibold text-gray-900"},"Per-Workflow Metrics")],-1)),t("table",At,[c[3]||(c[3]=t("thead",null,[t("tr",{class:"border-b border-gray-100 text-left text-xs font-medium uppercase tracking-wide text-gray-500"},[t("th",{class:"px-4 py-3"},"Topic"),t("th",{class:"px-4 py-3"},"Service"),t("th",{class:"px-4 py-3 text-right"},"Started"),t("th",{class:"px-4 py-3 text-right"},"Completed"),t("th",{class:"px-4 py-3 text-right"},"Failed"),t("th",{class:"px-4 py-3 text-right"},"Active"),t("th",{class:"px-4 py-3 text-right"},"Avg Duration"),t("th",{class:"px-4 py-3 text-right"},"Success Rate")])],-1)),t("tbody",Pt,[(r(!0),o(C,null,D(i.value.workflowMetrics,l=>(r(),o("tr",{key:l.topic+l.serviceName,class:"hover:bg-gray-50"},[t("td",Ft,a(l.topic),1),t("td",Et,a(l.serviceName||"-"),1),t("td",Mt,a(l.started),1),t("td",Bt,a(l.completed),1),t("td",Nt,a(l.failed),1),t("td",jt,a(l.active),1),t("td",Lt,a(l.avgDurationMs?(l.avgDurationMs/1e3).toFixed(1)+"s":"-"),1),t("td",Ut,[t("span",{class:b(["font-medium",l.successRate>=90?"text-emerald-600":l.successRate>=50?"text-amber-600":"text-red-600"])},a(u(l.successRate))+"% ",3)])]))),128))])])])):g("",!0)]))}};export{Gt as default};
